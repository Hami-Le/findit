<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FindIt - ·ª®ng D·ª•ng B·∫£o M·∫≠t v√† T√¨m ƒê·ªì</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header class="app-header-main">
        <div class="container header-container">
            <div class="logo">FindIt</div>
            
            <button class="hamburger-menu" id="hamburger-menu-button" aria-label="M·ªü menu" aria-expanded="false">
                <i class="fas fa-bars"></i>
            </button>

            <nav class="app-nav" id="main-app-nav"> 
                <ul>
                    <li><a href="#" class="nav-link active" data-view="view-homepage">Trang Ch·ªß</a></li>
                    <li><a href="#" class="nav-link" data-view="view-security">B·∫£o M·∫≠t</a></li>
                    <li><a href="#" class="nav-link" data-view="view-finditems">T√¨m ƒê·ªì</a></li>
                    <li><a href="#" class="nav-link" data-view="view-community">C·ªông ƒê·ªìng</a></li>
                </ul>
            </nav>
            <div class="user-profile-area">
                <img src="login4.png" alt="User Avatar" id="user-avatar-icon" class="user-avatar">
            </div>
        </div>
    </header>

    <div id="user-profile-fullpage-panel" class="profile-fullpage-panel">
        <div class="profile-panel-header">
            <h3>T√†i Kho·∫£n & C√†i ƒê·∫∑t</h3>
            <button class="close-profile-panel-btn" id="close-profile-panel-btn">&times;</button>
        </div>
        <div class="account-layout">
            <aside class="account-sidebar">
                <div class="account-sidebar-header">
                    <img src="login3.png" alt="User Avatar" class="account-avatar-large">
                    <h4>Ng∆∞·ªùi D√πng A</h4>
                    <p>user.a@example.com</p>
                </div>
                <ul>
                    <li><a href="#" class="account-nav-link active" data-account-section="account-personal-info"><i class="fas fa-user-edit"></i> Th√¥ng Tin C√° Nh√¢n</a></li>
                    <li><a href="#" class="account-nav-link" data-account-section="account-order-info"><i class="fas fa-file-invoice-dollar"></i> ƒê∆°n H√†ng & Premium</a></li>
                    <li><a href="#" class="account-nav-link" data-account-section="account-app-settings"><i class="fas fa-cogs"></i> C√†i ƒê·∫∑t ·ª®ng D·ª•ng</a></li>
                    <li><a href="#" class="account-nav-link" data-account-section="account-my-tags"><i class="fas fa-tags"></i> Thi·∫øt B·ªã Tag C·ªßa T√¥i</a></li>
                    <li><a href="#" class="account-nav-link" data-account-section="account-my-posts"><i class="fas fa-list-alt"></i> Tin ƒêƒÉng C·ªßa T√¥i</a></li>
                    <li><a href="#" id="logout-link" style="color: #dc3545;"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t</a></li>
                </ul>
            </aside>
            <section class="account-content-area">
                <div id="account-personal-info" class="account-section current-account-section">
                    <h3><i class="fas fa-user-edit"></i> Th√¥ng Tin C√° Nh√¢n</h3>
                        <form class="account-form">
                            <div><label>T√™n hi·ªÉn th·ªã:</label> <input type="text" value="Ng∆∞·ªùi D√πng A"></div>
                            <div><label>Email:</label> <input type="email" value="user.a@example.com" readonly></div>
                            <div><label>S·ªë ƒëi·ªán tho·∫°i:</label> <input type="tel" value="090xxxxxxx"></div>
                            <div><label>ƒê·ªãa ch·ªâ:</label> <textarea rows="3">123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ, ƒê√† N·∫µng</textarea></div>
                            <button type="submit" class="app-button">L∆∞u Thay ƒê·ªïi</button>
                        </form>
                        <hr>
                        <h4>ƒê·ªïi M·∫≠t Kh·∫©u</h4>
                        <form class="account-form">
                            <div><label>M·∫≠t kh·∫©u c≈©:</label> <input type="password"></div>
                            <div><label>M·∫≠t kh·∫©u m·ªõi:</label> <input type="password"></div>
                            <div><label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi:</label> <input type="password"></div>
                            <button type="submit" class="app-button">C·∫≠p Nh·∫≠t M·∫≠t Kh·∫©u</button>
                        </form>
                </div>
                <div id="account-order-info" class="account-section">
                    <h3><i class="fas fa-file-invoice-dollar"></i> ƒê∆°n H√†ng & G√≥i Premium</h3>
                        <div class="current-subscription-info">
                            <h4>G√≥i Hi·ªán T·∫°i C·ªßa B·∫°n</h4>
                            <div class="order-item-account">
                                <p><strong>G√≥i FindIt Premium - 1 NƒÉm</strong></p>
                                <p><strong>Ng√†y mua:</strong> 01/01/2025</p>
                                <p><strong>Ng√†y h·∫øt h·∫°n:</strong> 31/12/2025</p>
                                <p><strong>Tr·∫°ng th√°i:</strong> <span style="color: green; font-weight:bold;">ƒêang ho·∫°t ƒë·ªông</span></p>
                                <p><strong>Gi√°:</strong> 299.000 VNƒê</p>
                                <p><a href="#">Xem h√≥a ƒë∆°n chi ti·∫øt</a></p>
                            </div>
                        </div>
                        <hr class="section-divider">
                        <div class="premium-packages-showcase">
                            <h4>N√¢ng C·∫•p Ho·∫∑c Gia H·∫°n G√≥i Premium</h4>
                            <p>M·ªü kh√≥a to√†n b·ªô ti·ªÅm nƒÉng c·ªßa FindIt v·ªõi c√°c t√≠nh nƒÉng b·∫£o m·∫≠t v√† ti·ªán √≠ch v∆∞·ª£t tr·ªôi!</p>
                            <div class="packages-grid">
                                <div class="package-card">
                                    <div class="package-header"><h5>FindIt Premium</h5><span class="package-duration">1 Th√°ng</span></div>
                                    <div class="package-price"><span class="price-amount">29.000</span> VNƒê<span class="price-cycle">/ th√°ng</span></div>
                                    <ul class="package-features">
                                        <li><i class="fas fa-check-circle"></i> VPN t·ªëc ƒë·ªô cao</li>
                                        <li><i class="fas fa-check-circle"></i> Sao l∆∞u d·ªØ li·ªáu t·ª± ƒë·ªông</li>
                                        <li><i class="fas fa-check-circle"></i> V√† nhi·ªÅu t√≠nh nƒÉng kh√°c...</li>
                                    </ul>
                                    <button class="app-button choose-package-btn">Ch·ªçn G√≥i Th√°ng</button>
                                </div>
                                <div class="package-card recommended">
                                    <span class="recommended-badge">Ti·∫øt Ki·ªám 40%</span>
                                    <div class="package-header"><h5>FindIt Premium</h5><span class="package-duration">1 NƒÉm</span></div>
                                    <div class="package-price"><span class="price-amount">299.000</span> VNƒê<span class="price-cycle">/ nƒÉm</span><span class="price-original"><s>499.000 VNƒê</s></span></div>
                                    <ul class="package-features">
                                        <li><i class="fas fa-check-circle"></i> <strong>T·∫•t c·∫£ t√≠nh nƒÉng Premium</strong></li>
                                        <li><i class="fas fa-shield-alt"></i> B·∫£o m·∫≠t to√†n di·ªán</li>
                                        <li><i class="fas fa-map-marked-alt"></i> T√¨m ƒë·ªì kh√¥ng gi·ªõi h·∫°n</li>
                                    </ul>
                                    <button class="app-button choose-package-btn">Ch·ªçn G√≥i NƒÉm</button>
                                </div>
                            </div>
                        </div>
                </div>
                <div id="account-app-settings" class="account-section">
                    <h3><i class="fas fa-cogs"></i> C√†i ƒê·∫∑t ·ª®ng D·ª•ng</h3>
                        <div class="settings-category-account">
                            <h4>B·∫£o M·∫≠t N√¢ng Cao (Premium)</h4>
                            <ul>
                                <li><label class="toggle-switch"><span>Kh√≥a ·ª©ng d·ª•ng b·∫±ng v√¢n tay</span> <input type="checkbox" id="fingerprint-lock" checked> <span class="slider"></span></label></li>
                                <li><label class="toggle-switch"><span>C·∫£nh b√°o r√≤ r·ªâ m·∫≠t kh·∫©u</span> <input type="checkbox" id="leak-warning" checked> <span class="slider"></span></label></li>
                            </ul>
                        </div>
                        <div class="settings-category-account">
                            <h4>VPN (Premium)</h4>
                             <ul>
                                <li><label class="toggle-switch"><span>K√≠ch ho·∫°t VPN t·ªëc ƒë·ªô cao</span> <input type="checkbox" id="vpn-toggle"> <span class="slider"></span></label></li>
                                <li><label for="vpn-location">Ch·ªçn v·ªã tr√≠ m√°y ch·ªß:</label> <select id="vpn-location"><option>T·ª± ƒë·ªông</option><option>Singapore</option><option>Hoa K·ª≥</option></select></li>
                            </ul>
                        </div>
                        <div class="settings-category-account">
                            <h4>Sao L∆∞u D·ªØ Li·ªáu T·ª± ƒê·ªông (Premium)</h4>
                            <ul>
                                <li><label class="toggle-switch"><span>B·∫≠t sao l∆∞u t·ª± ƒë·ªông</span> <input type="checkbox" id="auto-backup" checked> <span class="slider"></span></label></li>
                                <li><p>Sao l∆∞u v√†o: Google Drive (user.a@example.com)</p></li>
                                <li><button class="app-button-outline small-btn">Thay ƒë·ªïi t√†i kho·∫£n sao l∆∞u</button></li>
                            </ul>
                        </div>
                        <div class="settings-category-account">
                            <h4>Th√¥ng B√°o Chung</h4>
                             <ul>
                                <li><label class="toggle-switch"><span>Th√¥ng b√°o c·∫≠p nh·∫≠t ·ª©ng d·ª•ng</span> <input type="checkbox" checked> <span class="slider"></span></label></li>
                                <li><label class="toggle-switch"><span>Th√¥ng b√°o t·ª´ c·ªông ƒë·ªìng FindIt</span> <input type="checkbox" checked> <span class="slider"></span></label></li>
                                <li><label class="toggle-switch"><span>C·∫£nh b√°o b·ªè qu√™n ƒë·ªì v·∫≠t (khi d√πng Tag)</span> <input type="checkbox"> <span class="slider"></span></label></li>
                            </ul>
                        </div>
                        <div class="settings-category-account">
                            <h4>Ng√¥n Ng·ªØ & Giao Di·ªán</h4>
                            <ul>
                                <li><label for="app-language">Ng√¥n ng·ªØ hi·ªÉn th·ªã:</label> <select id="app-language"><option>Ti·∫øng Vi·ªát</option><option>English</option></select></li>
                                <li><label class="toggle-switch"><span>Ch·∫ø ƒë·ªô t·ªëi (Dark Mode)</span> <input type="checkbox" id="dark-mode"> <span class="slider"></span></label></li>
                            </ul>
                        </div>
                </div>
                <div id="account-my-tags" class="account-section">
                    <h3><i class="fas fa-tags"></i> Thi·∫øt B·ªã Tag C·ªßa T√¥i</h3>
                        <p>Qu·∫£n l√Ω c√°c thi·∫øt b·ªã Bluetooth Tag b·∫°n ƒë√£ k·∫øt n·ªëi v·ªõi FindIt.</p>
                         <ul id="account-tag-list">
                            </ul>
                         <button class="app-button" onclick="navigateToView('view-finditems', document.querySelector('[data-view=view-finditems]')); setTimeout(()=>openModal('add-tag-modal'),50);"><i class="fas fa-plus-circle"></i> Th√™m Tag M·ªõi</button>
                </div>
                 <div id="account-my-posts" class="account-section">
                    <h3><i class="fas fa-list-alt"></i> Tin ƒêƒÉng C·ªông ƒê·ªìng C·ªßa T√¥i</h3>
                        <p>Xem l·∫°i v√† qu·∫£n l√Ω c√°c tin b·∫°n ƒë√£ ƒëƒÉng tr√™n c·ªông ƒë·ªìng Lost & Found.</p>
                        <div id="account-user-post-list">
                            <p><em>B·∫°n ch∆∞a ƒëƒÉng tin n√†o.</em></p>
                        </div>
                        <button class="app-button" onclick="navigateToViewAndOpenModal('view-community', document.querySelector('[data-view=view-community]'), 'add-post-modal', 'lost');"><i class="fas fa-plus-circle"></i> ƒêƒÉng Tin M·ªõi</button>
                </div>
            </section>
        </div>
    </div>


    <main id="app-main-content" class="container">
        <div id="view-homepage" class="app-view current-view">
            <h2>Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi FindIt!</h2>
            <p class="section-subtitle">Gi·∫£i ph√°p to√†n di·ªán cho an to√†n thi·∫øt b·ªã v√† t√¨m ki·∫øm ƒë·ªì th·∫•t l·∫°c.</p>
             <div class="homepage-grid">
                <div class="homepage-card" onclick="navigateToView('view-security', document.querySelector('.app-nav a[data-view=view-security]'))">
                    <i class="fas fa-shield-alt fa-3x"></i>
                    <h4>B·∫£o M·∫≠t To√†n Di·ªán</h4>
                    <p>Qu√©t virus, d·ªçn d·∫πp h·ªá th·ªëng, qu·∫£n l√Ω quy·ªÅn.</p>
                </div>
                <div class="homepage-card" onclick="navigateToView('view-finditems', document.querySelector('.app-nav a[data-view=view-finditems]'))">
                    <i class="fas fa-map-marker-alt fa-3x"></i>
                    <h4>T√¨m ƒê·ªì Th√¥ng Minh</h4>
                    <p>Theo d√µi v·ªã tr√≠ c√°c v·∫≠t d·ª•ng quan tr·ªçng v·ªõi Tag.</p>
                </div>
                <div class="homepage-card" onclick="navigateToView('view-community', document.querySelector('.app-nav a[data-view=view-community]'))">
                    <i class="fas fa-users fa-3x"></i>
                    <h4>C·ªông ƒê·ªìng H·ªó Tr·ª£</h4>
                    <p>ƒêƒÉng tin t√¨m ƒë·ªì, gi√∫p ƒë·ª° v√† nh·∫≠n th∆∞·ªüng.</p>
                </div>
                 <div class="homepage-card premium-upsell">
                    <i class="fas fa-star fa-3x"></i>
                    <h4>N√¢ng C·∫•p Premium</h4>
                    <p>Tr·∫£i nghi·ªám VPN, sao l∆∞u, b·∫£o m·∫≠t n√¢ng cao!</p>
                    <button class="app-button small-btn" onclick="openAccountPageToSection('account-order-info')">T√¨m hi·ªÉu th√™m</button>
                </div>
            </div>
        </div>

        <div id="view-security" class="app-view">
             <h2>B·∫£o M·∫≠t & T·ªëi ∆Øu H·ªá Th·ªëng</h2>
            <div class="security-features-grid">
                <div class="security-feature-item">
                    <i class="fas fa-microchip fa-2x"></i>
                    <h4>Qu√©t Ph·∫ßn M·ªÅm ƒê·ªôc H·∫°i</h4>
                    <p>Ph√°t hi·ªán v√† lo·∫°i b·ªè virus, m√£ ƒë·ªôc ƒë·ªÉ b·∫£o v·ªá thi·∫øt b·ªã c·ªßa b·∫°n.</p>
                    <button class="app-button-outline small-btn" id="start-security-scan-btn-main">Qu√©t Ngay</button>
                </div>
                <div class="security-feature-item">
                    <i class="fas fa-broom fa-2x"></i>
                    <h4>D·ªçn B·ªô ƒê·ªám & R√°c</h4>
                    <p>Gi·∫£i ph√≥ng dung l∆∞·ª£ng, tƒÉng t·ªëc ƒë·ªô ho·∫°t ƒë·ªông c·ªßa ƒëi·ªán tho·∫°i.</p>
                    <button class="app-button-outline small-btn" onclick="alert('T√≠nh nƒÉng D·ªçn b·ªô ƒë·ªám ƒëang m√¥ ph·ªèng!')">D·ªçn D·∫πp Ngay</button>
                </div>
                <div class="security-feature-item">
                    <i class="fas fa-user-shield fa-2x"></i>
                    <h4>Qu·∫£n L√Ω Quy·ªÅn ·ª®ng D·ª•ng</h4>
                    <p>Ki·ªÉm so√°t c√°c quy·ªÅn truy c·∫≠p c·ªßa ·ª©ng d·ª•ng ƒë·ªÉ b·∫£o v·ªá th√¥ng tin c√° nh√¢n.</p>
                    <button class="app-button-outline small-btn" onclick="alert('T√≠nh nƒÉng Qu·∫£n l√Ω quy·ªÅn ƒëang m√¥ ph·ªèng!')">Qu·∫£n L√Ω Quy·ªÅn</button>
                </div>
            </div>
            <div id="security-scan-simulation-area" style="margin-top: 20px; padding: 20px; background-color: #f9fafb; border-radius: 6px; display:none;">
                 <div class="scan-icon-area">
                     <img src="https://via.placeholder.com/80x80?text=üõ°Ô∏è" alt="Security Icon" id="security-scan-icon-img">
                </div>
                <div id="security-scan-progress-container" style="display: none;">
                    <p id="security-scan-step-text">ƒêang c·∫≠p nh·∫≠t c∆° s·ªü d·ªØ li·ªáu virus...</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="security-scan-progress-bar"></div>
                    </div>
                </div>
                <div class="scan-results-detailed" id="security-scan-results-detailed" style="display: none;">
                    <h4>Ho√†n T·∫•t Qu√©t!</h4>
                    <p id="security-scan-summary">Kh√¥ng t√¨m th·∫•y m·ªëi ƒëe d·ªça n√†o.</p>
                    <button class="app-button small-btn" onclick="resetSecurityScan()">Qu√©t L·∫°i</button>
                </div>
            </div>
            <div class="premium-features-showcase">
                <h3><i class="fas fa-star"></i> T√≠nh NƒÉng Premium</h3>
                <div class="premium-feature">
                    <i class="fas fa-vpn fa-2x"></i> 
                    <div>
                        <h4>VPN T·ªëc ƒê·ªô Cao</h4>
                        <p>Duy·ªát web an to√†n, ·∫©n danh v√† kh√¥ng gi·ªõi h·∫°n.</p>
                    </div>
                </div>
                <div class="premium-feature">
                    <i class="fas fa-cloud-upload-alt fa-2x"></i>
                    <div>
                        <h4>Sao L∆∞u D·ªØ Li·ªáu T·ª± ƒê·ªông</h4>
                        <p>B·∫£o v·ªá ·∫£nh, video, danh b·∫° c·ªßa b·∫°n tr√™n ƒë√°m m√¢y.</p>
                    </div>
                </div>
                 <div class="premium-feature" onclick="openAccountPageToSection('account-app-settings')">
                    <i class="fas fa-fingerprint fa-2x"></i>
                    <div>
                        <h4>Kh√≥a ·ª®ng D·ª•ng & C·∫£nh B√°o</h4>
                        <p>B·∫£o m·∫≠t b·∫±ng v√¢n tay, c·∫£nh b√°o r√≤ r·ªâ m·∫≠t kh·∫©u.</p>
                    </div>
                </div>
                <button class="app-button" style="margin-top:15px;" onclick="openAccountPageToSection('account-order-info')">N√¢ng C·∫•p L√™n Premium</button>
            </div>
        </div>

        <div id="view-finditems" class="app-view">
             <div class="view-header-controls">
                <h2>T√¨m ƒê·ªì V·∫≠t C·ªßa B·∫°n</h2>
                <button class="app-button" onclick="openModal('add-tag-modal')">Th√™m Thi·∫øt B·ªã Tag M·ªõi (+)</button>
            </div>
            <p class="section-subtitle">Mua v√† g·∫Øn Bluetooth Tag c·ªßa FindIt v√†o v√≠, ch√¨a kh√≥a, ho·∫∑c b·∫•t k·ª≥ v·∫≠t d·ª•ng quan tr·ªçng n√†o ƒë·ªÉ d·ªÖ d√†ng theo d√µi v·ªã tr√≠ c·ªßa ch√∫ng ngay tr√™n b·∫£n ƒë·ªì.</p>
            <div class="finditems-layout">
                <div class="item-list-panel">
                    <h4>Danh S√°ch V·∫≠t D·ª•ng (<span id="tag-count-display">3</span>)</h4>
                    <ul id="main-tag-item-list">
                        {/* JS s·∫Ω render */}
                    </ul>
                </div>
                <div class="map-details-panel">
                    <h4>V·ªã Tr√≠ & Chi Ti·∫øt Tag</h4>
                    <div class="map-placeholder-large">
                        <img src="https://via.placeholder.com/600x350?text=B·∫£n+ƒë·ªì+FindIt" alt="Map View Placeholder" id="main-map-image">
                        <p id="map-selected-tag-name">Ch·ªçn m·ªôt v·∫≠t d·ª•ng ƒë·ªÉ xem v·ªã tr√≠ chi ti·∫øt.</p>
                    </div>
                     <div id="selected-tag-details-main" class="selected-tag-info" style="display:none;">
                        <h5 id="details-main-tag-name"></h5>
                        <p>Tr·∫°ng th√°i: <span id="details-main-tag-status"></span></p>
                        <p>Pin: <span id="details-main-tag-battery"></span>%</p>
                        <div class="tag-actions">
                            <button class="app-button" id="main-ring-tag-btn"><i class="fas fa-bell"></i> ƒê·ªï Chu√¥ng</button>
                            <button class="app-button btn-danger" id="main-report-lost-btn"><i class="fas fa-exclamation-triangle"></i> B√°o M·∫•t</button>
                        </div>
                    </div>
                </div>
            </div>
             <div class="community-link-from-finditems">
                <h4>Th·∫•t L·∫°c ƒê·ªì V·∫≠t?</h4>
                <p>ƒêƒÉng tin l√™n C·ªông ƒê·ªìng Lost & Found c·ªßa FindIt ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c s·ª± gi√∫p ƒë·ª° v√† c√≥ c∆° h·ªôi t√¨m l·∫°i nhanh h∆°n. B·∫°n c√≥ th·ªÉ treo th∆∞·ªüng ƒë·ªÉ tƒÉng ƒë·ªông l·ª±c cho ng∆∞·ªùi t√¨m th·∫•y.</p>
                <button class="app-button-outline" onclick="navigateToViewAndOpenModal('view-community', document.querySelector('.app-nav a[data-view=view-community]'), 'add-post-modal', 'lost')">
                    <i class="fas fa-bullhorn"></i> ƒêƒÉng Tin M·∫•t ƒê·ªì Ngay
                </button>
            </div>
        </div>
        
        <div id="view-community" class="app-view">
            <div class="view-header-controls">
                <h2>C·ªông ƒê·ªìng Lost & Found</h2>
                <div>
                    <button class="app-button" onclick="openModalAndSetType('add-post-modal', 'lost')"><i class="fas fa-bullhorn"></i> ƒêƒÉng Tin M·∫•t ƒê·ªì</button>
                    <button class="app-button" onclick="openModalAndSetType('add-post-modal', 'found')" style="margin-left: 10px;"><i class="fas fa-hand-holding-heart"></i> B√°o Tin Nh·∫∑t ƒê∆∞·ª£c</button>
                </div>
            </div>
            <p class="section-subtitle">N∆°i k·∫øt n·ªëi nh·ªØng ng∆∞·ªùi m·∫•t ƒë·ªì v√† ng∆∞·ªùi nh·∫∑t ƒë∆∞·ª£c. Ng∆∞·ªùi m·∫•t ƒëƒÉng th√¥ng tin + treo th∆∞·ªüng. Ng∆∞·ªùi nh·∫∑t ƒë∆∞·ª£c c√≥ th·ªÉ ch·ª•p ·∫£nh, g·ª≠i l√™n app.</p>
            <div class="community-content">
                <div class="community-filters-main">
                    <button class="filter-btn active" data-filter="all">T·∫•t c·∫£</button>
                    <button class="filter-btn" data-filter="lost">Tin M·∫•t ƒê·ªì</button>
                    <button class="filter-btn" data-filter="found">Tin Nh·∫∑t ƒê∆∞·ª£c</button>
                    <input type="text" placeholder="T√¨m ki·∫øm (v√≠ d·ª•: ch√¨a kh√≥a, v√≠, qu·∫≠n H·∫£i Ch√¢u...)" class="search-input-community" id="community-search-input">
                </div>
                <div class="post-list-main" id="main-post-list">
                   {/* JS s·∫Ω render */}
                </div>
                <p id="no-community-results" style="text-align:center; padding: 20px; display:none;">Kh√¥ng t√¨m th·∫•y tin ƒëƒÉng ph√π h·ª£p.</p>
            </div>
        </div>
        </main>

    <div class="app-modal-overlay" id="add-tag-modal">
        <div class="modal-content-main">
            <span class="close-button-main" onclick="closeModal('add-tag-modal')">&times;</span>
            <h4>Th√™m Thi·∫øt B·ªã Tag M·ªõi</h4>
            <label for="tag-name-main">T√™n thi·∫øt b·ªã:</label>
            <input type="text" id="tag-name-main" placeholder="V√≠ d·ª•: Ch√¨a kh√≥a xe">
            <label for="tag-icon-main">Ch·ªçn bi·ªÉu t∆∞·ª£ng (emoji):</label>
            <input type="text" id="tag-icon-main" placeholder="V√≠ d·ª•: üîë">
            <button class="app-button" onclick="submitNewTagMain()">L∆∞u Thi·∫øt B·ªã</button>
        </div>
    </div>
    
    <div class="app-modal-overlay" id="add-post-modal">
        <div class="modal-content-main">
            <span class="close-button-main" onclick="closeModal('add-post-modal')">&times;</span>
            <h4 id="add-post-modal-title">ƒêƒÉng Tin M·ªõi L√™n C·ªông ƒê·ªìng</h4>
            <label for="post-title-main">Ti√™u ƒë·ªÅ:</label>
            <input type="text" id="post-title-main" placeholder="V√≠ d·ª•: M·∫•t ch√¨a kh√≥a xe t·∫°i...">
            
            <input type="hidden" id="post-type-hidden" value="lost">

            <div id="reward-field-container" style="display:none;">
                 <label for="post-reward-main">Treo th∆∞·ªüng (VNƒê, n·∫øu c√≥):</label>
                 <input type="number" id="post-reward-main" placeholder="V√≠ d·ª•: 200000">
            </div>

            <label for="post-description-main">M√¥ t·∫£ chi ti·∫øt:</label>
            <textarea id="post-description-main" rows="3" placeholder="M√¥ t·∫£ ƒë·ªì v·∫≠t, th·ªùi gian, ƒë·ªãa ƒëi·ªÉm..."></textarea>
            <label for="post-location-main">Khu v·ª±c:</label>
            <input type="text" id="post-location-main" placeholder="V√≠ d·ª•: Qu·∫≠n H·∫£i Ch√¢u, ƒê√† N·∫µng">
            <label for="post-image-main">·∫¢nh ƒë√≠nh k√®m (m√¥ ph·ªèng):</label>
            <input type="file" id="post-image-main" accept="image/*">
            <button class="app-button" onclick="submitNewPostMain()">ƒêƒÉng Tin</button>
        </div>
    </div>

    <footer class="app-footer-main">
        <div class="container">
            <p>&copy; 2025 FindIt. B·∫£o v·ªá v√† k·∫øt n·ªëi c·ªông ƒë·ªìng.</p>
        </div>
    </footer>

    <script>
        const navLinks = document.querySelectorAll('.app-header-main .app-nav .nav-link');
        const appViews = document.querySelectorAll('#app-main-content .app-view'); // Ch·ªâ l·∫•y view trong main
        const userAvatarIcon = document.getElementById('user-avatar-icon');
        const userProfileFullPagePanel = document.getElementById('user-profile-fullpage-panel');
        const closeProfilePanelButton = document.getElementById('close-profile-panel-btn');
        
        const accountSidebarLinks = document.querySelectorAll('.account-sidebar .account-nav-link');
        const accountSections = document.querySelectorAll('.account-content-area .account-section');

        let currentTagCount = 3; 
        const dashboardTrackedItemsSpan = document.getElementById('dashboard-tracked-items');
        const tagCountSpanDisplay = document.getElementById('tag-count-display'); // ƒê·ªïi ID cho span ·ªü view-finditems
        
        let myTags = [ 
            { name: 'Ch√¨a kh√≥a nh√†', status: '·ªû g·∫ßn b·∫°n (Ph√≤ng kh√°ch)', battery: 90, icon: 'üîë' },
            { name: 'V√≠ ti·ªÅn', status: 'L·∫ßn cu·ªëi th·∫•y: Ng√¢n h√†ng ABC, 15 ph√∫t tr∆∞·ªõc', battery: 45, icon: 'üí∞' },
            { name: 'Ba l√¥ c√¥ng t√°c', status: 'T·∫°i vƒÉn ph√≤ng, t·∫ßng 3', battery: 70, icon: 'üéí' }
        ];
        let myPosts = []; 

        function showMainView(viewIdToShow) {
            appViews.forEach(view => view.classList.remove('current-view'));
            const targetView = document.getElementById(viewIdToShow);
            if (targetView) {
                targetView.classList.add('current-view');
            }
        }
        
        function setActiveNavLink(clickedLink) {
            navLinks.forEach(link => link.classList.remove('active'));
            if(clickedLink) clickedLink.classList.add('active');
        }

        function navigateToView(viewId, clickedLinkElementOrNull) {
            showMainView(viewId);
            setActiveNavLink(clickedLinkElementOrNull);
            if (userProfileFullPagePanel.classList.contains('active')) {
                userProfileFullPagePanel.classList.remove('active'); // ƒê√≥ng panel t√†i kho·∫£n n·∫øu ƒëang m·ªü
            }
        }
        
        function openAccountPageToSection(accountSectionId) {
            if (!userProfileFullPagePanel.classList.contains('active')) {
                userProfileFullPagePanel.classList.add('active');
            }
            const targetLink = document.querySelector(`.account-sidebar .account-nav-link[data-account-section="${accountSectionId}"]`);
            navigateToAccountSectionInternal(accountSectionId, targetLink);
            // Kh√¥ng chuy·ªÉn view ch√≠nh ·ªü ƒë√¢y n·ªØa
        }


        function navigateToAccountSectionInternal(sectionId, clickedLinkElement) {
            accountSections.forEach(section => section.classList.remove('current-account-section'));
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('current-account-section');
            }

            accountSidebarLinks.forEach(link => link.classList.remove('active'));
            if (clickedLinkElement) {
                clickedLinkElement.classList.add('active');
            }
        }

        if (userAvatarIcon) {
            userAvatarIcon.addEventListener('click', (event) => {
                event.preventDefault();
                event.stopPropagation();
                userProfileFullPagePanel.classList.add('active');
                // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã th√¥ng tin c√° nh√¢n khi m·ªü panel
                const initialAccountLink = document.querySelector('.account-sidebar .account-nav-link[data-account-section="account-personal-info"]');
                navigateToAccountSectionInternal('account-personal-info', initialAccountLink);
            });
        }
        if (closeProfilePanelButton) {
            closeProfilePanelButton.addEventListener('click', () => {
                userProfileFullPagePanel.classList.remove('active');
            });
        }
        
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const viewId = link.getAttribute('data-view');
                navigateToView(viewId, link);
            });
        });

        accountSidebarLinks.forEach(link => {
            const sectionId = link.getAttribute('data-account-section');
            if (sectionId) { 
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    navigateToAccountSectionInternal(sectionId, link);
                });
            }
        });
        
        const logoutLink = document.getElementById('logout-link');
        if(logoutLink) {
            logoutLink.addEventListener('click', (event) => {
                event.preventDefault();
                alert("ƒêƒÉng xu·∫•t th√†nh c√¥ng! (m√¥ ph·ªèng)");
                userProfileFullPagePanel.classList.remove('active');
                navigateToView('view-homepage', document.querySelector('.app-nav .nav-link[data-view="view-homepage"]'));
            });
        }
        
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'flex';
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'none';
        }
        
        function openModalAndSetType(modalId, type) {
            openModal(modalId);
            const typeInput = document.getElementById('post-type-hidden');
            const rewardField = document.getElementById('reward-field-container');
            const modalTitle = document.getElementById('add-post-modal-title');

            if (typeInput) typeInput.value = type;
            if (type === 'lost') {
                if(rewardField) rewardField.style.display = 'block';
                if(modalTitle) modalTitle.textContent = 'ƒêƒÉng Tin M·∫•t ƒê·ªì';
            } else { 
                if(rewardField) rewardField.style.display = 'none';
                if(modalTitle) modalTitle.textContent = 'B√°o Tin Nh·∫∑t ƒê∆∞·ª£c';
            }
        }
        
        function navigateToViewAndOpenModal(viewId, clickedViewLink, modalId, postType = 'lost') {
            navigateToView(viewId, clickedViewLink);
            setTimeout(() => {
                openModalAndSetType(modalId, postType);
            }, 100); 
        }

        const securityScanBtn = document.getElementById('start-security-scan-btn-main');
        const securityScanProgressContainer = document.getElementById('security-scan-progress-container');
        const securityScanStepText = document.getElementById('security-scan-step-text');
        const securityScanProgressBar = document.getElementById('security-scan-progress-bar');
        const securityScanResultsDiv = document.getElementById('security-scan-results-detailed');
        const securityScanIconImg = document.getElementById('security-scan-icon-img');
        const securityScanSimulationArea = document.getElementById('security-scan-simulation-area');

        const securityScanSteps = [
            { text: "ƒêang c·∫≠p nh·∫≠t c∆° s·ªü d·ªØ li·ªáu virus...", duration: 1000, progress: 20 },
            { text: "Qu√©t nhanh c√°c khu v·ª±c quan tr·ªçng...", duration: 1500, progress: 50 },
            { text: "Qu√©t s√¢u c√°c ·ª©ng d·ª•ng ƒë√£ c√†i ƒë·∫∑t...", duration: 2000, progress: 80 },
            { text: "Ho√†n t·∫•t v√† ki·ªÉm tra b·ªô ƒë·ªám...", duration: 1000, progress: 100 }
        ];

        function resetSecurityScan() {
            if(securityScanBtn) securityScanBtn.style.display = 'block';
            if(securityScanBtn) securityScanBtn.disabled = false;
            if(securityScanIconImg) securityScanIconImg.style.display = 'block';
            if(securityScanProgressContainer) securityScanProgressContainer.style.display = 'none';
            if(securityScanResultsDiv) securityScanResultsDiv.style.display = 'none';
            if(securityScanProgressBar) securityScanProgressBar.style.width = '0%';
            if(securityScanSimulationArea) securityScanSimulationArea.style.display = 'none';
        }
        
        if(securityScanBtn){
            securityScanBtn.addEventListener('click', () => {
                if(securityScanSimulationArea) securityScanSimulationArea.style.display = 'block';
                securityScanBtn.disabled = true; 
                if(securityScanIconImg) securityScanIconImg.style.display = 'none';
                if(securityScanProgressContainer) securityScanProgressContainer.style.display = 'block';
                if(securityScanResultsDiv) securityScanResultsDiv.style.display = 'none';
                let currentSecurityStep = 0;
                let cumulativeSecurityProgress = 0;

                function processSecurityStep() {
                    if (currentSecurityStep < securityScanSteps.length) {
                        const step = securityScanSteps[currentSecurityStep];
                        if(securityScanStepText) securityScanStepText.innerHTML = step.text;
                        
                        let startProgress = cumulativeSecurityProgress;
                        if (currentSecurityStep > 0) startProgress = securityScanSteps[currentSecurityStep-1].progress;
                        
                        let targetProgress = step.progress;
                        let animationDuration = step.duration;
                        let startTime = null;

                        function animateSecurityProgress(timestamp) {
                            if (!startTime) startTime = timestamp;
                            const elapsedTime = timestamp - startTime;
                            const progressFraction = Math.min(elapsedTime / animationDuration, 1);
                            const currentDisplayProgress = startProgress + (targetProgress - startProgress) * progressFraction;
                            if(securityScanProgressBar) securityScanProgressBar.style.width = currentDisplayProgress + '%';

                            if (progressFraction < 1) {
                                requestAnimationFrame(animateSecurityProgress);
                            } else {
                                cumulativeSecurityProgress = targetProgress;
                                currentSecurityStep++;
                                setTimeout(processSecurityStep, 200);
                            }
                        }
                        requestAnimationFrame(animateSecurityProgress);

                    } else {
                        if(securityScanProgressContainer) securityScanProgressContainer.style.display = 'none';
                        if(securityScanResultsDiv) securityScanResultsDiv.style.display = 'block';
                        const summaryEl = document.getElementById('security-scan-summary');
                        if (summaryEl) summaryEl.textContent = `ƒê√£ qu√©t ${Math.floor(Math.random() * 10000) + 10000} t·ªáp v√† ${Math.floor(Math.random() * 50) + 50} ·ª©ng d·ª•ng. Kh√¥ng t√¨m th·∫•y m·ªëi ƒëe d·ªça n√†o.`;
                         securityScanBtn.disabled = false; 
                    }
                }
                processSecurityStep();
            });
        }

        const mainTagItemList = document.getElementById('main-tag-item-list');
        const accountTagList = document.getElementById('account-tag-list');
        const mainMapImage = document.getElementById('main-map-image');
        const mapSelectedTagName = document.getElementById('map-selected-tag-name');
        const selectedTagDetailsMainDiv = document.getElementById('selected-tag-details-main');

        function renderMyTags() {
            if (mainTagItemList) mainTagItemList.innerHTML = '';
            if (accountTagList) accountTagList.innerHTML = '';

            myTags.forEach(tag => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<span>${tag.icon} ${tag.name}</span> <span class="${tag.status.includes('·ªû g·∫ßn') ? 'item-status-nearby' : 'item-status-lost'}">${tag.status.split('(')[0].trim()}</span>`;
                listItem.onclick = () => showTagDetailsMain(tag.name, tag.status, tag.battery, tag.icon);
                if (mainTagItemList) mainTagItemList.appendChild(listItem.cloneNode(true));

                const accountListItem = document.createElement('li');
                accountListItem.innerHTML = `<span>${tag.icon} ${tag.name}</span> <span>Pin: ${tag.battery}%</span> <button class="app-button-outline small-btn" onclick="navigateToView('view-finditems', document.querySelector('.app-nav a[data-view=view-finditems]')); setTimeout(()=>showTagDetailsMain('${tag.name}', '${tag.status}', ${tag.battery}, '${tag.icon}'),50);">Xem tr√™n b·∫£n ƒë·ªì</button>`;
                if (accountTagList) accountTagList.appendChild(accountListItem);
            });
            if(tagCountSpanDisplay) tagCountSpanDisplay.textContent = myTags.length;
            if(dashboardTrackedItemsSpan) dashboardTrackedItemsSpan.textContent = `${myTags.length} v·∫≠t d·ª•ng`;
        }

        function submitNewTagMain() {
            const tagNameInput = document.getElementById('tag-name-main');
            const tagIconInput = document.getElementById('tag-icon-main');
            const tagName = tagNameInput.value;
            const tagIcon = tagIconInput.value || 'üè∑Ô∏è';

            if (tagName) {
                myTags.push({name: tagName, status: 'V·ª´a th√™m, ·ªü g·∫ßn', battery: 100, icon: tagIcon});
                renderMyTags();
                
                tagNameInput.value = '';
                tagIconInput.value = '';
                closeModal('add-tag-modal');
            } else {
                alert("Vui l√≤ng nh·∫≠p t√™n thi·∫øt b·ªã!");
            }
        }
        
        function showTagDetailsMain(name, status, battery, icon) {
            if (!selectedTagDetailsMainDiv || !mainMapImage || !mapSelectedTagName) return;

            selectedTagDetailsMainDiv.style.display = 'block';
            const detailsNameEl = document.getElementById('details-main-tag-name');
            const detailsStatusEl = document.getElementById('details-main-tag-status');
            const detailsBatteryEl = document.getElementById('details-main-tag-battery');

            if(detailsNameEl) detailsNameEl.textContent = `${icon} ${name}`;
            if(detailsStatusEl) detailsStatusEl.textContent = status;
            if(detailsBatteryEl) detailsBatteryEl.textContent = battery;
            
            mainMapImage.src = `https://via.placeholder.com/600x350?text=V·ªã+tr√≠+${name.replace(/\s/g, "+")}`;
            mapSelectedTagName.textContent = `Hi·ªÉn th·ªã v·ªã tr√≠ cho: ${icon} ${name}`;

            const ringBtn = document.getElementById('main-ring-tag-btn');
            if(ringBtn) {
                ringBtn.textContent = "ƒê·ªï Chu√¥ng";
                ringBtn.onclick = function() {
                    if (this.textContent.includes("ƒê·ªï Chu√¥ng")) {
                        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêang ƒë·ªï chu√¥ng...';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-volume-mute"></i> D·ª´ng ƒê·ªï Chu√¥ng';
                        }, 3000);
                    } else {
                        this.innerHTML = '<i class="fas fa-bell"></i> ƒê·ªï Chu√¥ng';
                    }
                };
            }
            selectedTagDetailsMainDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        const mainPostListDiv = document.getElementById('main-post-list');
        const accountUserPostListDiv = document.getElementById('account-user-post-list');
        const communitySearchInput = document.getElementById('community-search-input');
        const communityFilterBtns = document.querySelectorAll('#view-community .filter-btn');
        const noCommunityResultsP = document.getElementById('no-community-results');

        let allCommunityPosts = [ 
            { id: 1, title: 'M·∫•t ch√πm ch√¨a kh√≥a xe m√°y v√† nh√† ·ªü Qu·∫≠n H·∫£i Ch√¢u', type: 'lost', reward: '200.000 VNƒê', description: 'M√¨nh c√≥ l√†m r∆°i ch√πm ch√¨a kh√≥a g·ªìm 1 ch√¨a kh√≥a xe Wave v√† 2 ch√¨a kh√≥a nh√†, c√≥ m√≥c h√¨nh con m√®o g·∫ßn ƒë∆∞·ªùng Nguy·ªÖn VƒÉn Linh. Ai nh·∫∑t ƒë∆∞·ª£c l√†m ∆°n ch·ª•p ·∫£nh g·ª≠i l√™n app ho·∫∑c li√™n h·ªá SƒêT XXX. Xin c·∫£m ∆°n v√† h·∫≠u t·∫°!', location: 'Qu·∫≠n H·∫£i Ch√¢u, ƒê√† N·∫µng', user: 'UserA', time: '20 ph√∫t tr∆∞·ªõc', image: 'https://via.placeholder.com/80x80?text=üîë', keywords: 'ch√¨a kh√≥a xe m√°y nh√† qu·∫≠n h·∫£i ch√¢u nguy·ªÖn vƒÉn linh m√®o' },
            { id: 2, title: 'Nh·∫∑t ƒë∆∞·ª£c v√≠ da m√†u n√¢u t·∫°i c·ªïng ƒê·∫°i h·ªçc VKU', type: 'found', reward: null, description: 'S√°ng nay kho·∫£ng 8h, m√¨nh nh·∫∑t ƒë∆∞·ª£c 1 v√≠ da m√†u n√¢u ·ªü khu v·ª±c c·ªïng tr∆∞·ªùng VKU. B√™n trong c√≥ gi·∫•y t·ªù mang t√™n L√™ VƒÉn B v√† m·ªôt √≠t ti·ªÅn m·∫∑t. ·∫¢nh v√≠ ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√®m. Ch·ªß nh√¢n vui l√≤ng li√™n h·ªá SƒêT YYY ƒë·ªÉ nh·∫≠n l·∫°i.', location: 'ƒê·∫°i h·ªçc VKU', user: 'UserB', time: '1 gi·ªù tr∆∞·ªõc', image: 'https://via.placeholder.com/80x80?text=V√≠', keywords: 'v√≠ da n√¢u c·ªïng ƒë·∫°i h·ªçc vku cmnd l√™ vƒÉn b ti·ªÅn m·∫∑t' },
            { id: 3, title: 'T√¨m ƒëi·ªán tho·∫°i iPhone 13 Pro Max r∆°i ·ªü Vincom', type: 'lost', reward: 'Th·ªèa thu·∫≠n', description: 'M√¨nh ƒë·ªÉ qu√™n ƒëi·ªán tho·∫°i iPhone 13 Pro Max m√†u xanh tr√™n gh·∫ø ·ªü khu ·∫©m th·ª±c Vincom chi·ªÅu qua. Mong t√¨m l·∫°i ƒë∆∞·ª£c, xin c·∫£m ∆°n v√† h·∫≠u t·∫°.', location: 'Vincom ƒê√† N·∫µng', user: 'UserC', time: 'H√¥m qua', image: 'https://via.placeholder.com/80x80?text=üì±', keywords: 'ƒëi·ªán tho·∫°i iphone 13 pro max vincom xanh'},
            { id: 4, title: 'Nh·∫∑t ƒë∆∞·ª£c tai nghe Airpods Pro g·∫ßn c·∫ßu R·ªìng', type: 'found', reward: null, description: 'M√¨nh nh·∫∑t ƒë∆∞·ª£c m·ªôt h·ªôp tai nghe Airpods Pro m√†u tr·∫Øng, c√≤n m·ªõi, g·∫ßn khu v·ª±c c·∫ßu R·ªìng t·ªëi qua. Ai l√† ch·ªß nh√¢n li√™n h·ªá m√¨nh nh√©.', location: 'C·∫ßu R·ªìng, ƒê√† N·∫µng', user: 'UserD', time: 'T·ªëi qua', image: 'https://via.placeholder.com/80x80?text=üéß', keywords: 'tai nghe airpods pro c·∫ßu r·ªìng tr·∫Øng'}
        ];
        
        function renderCommunityPosts(postsToRender = allCommunityPosts) {
            if (!mainPostListDiv) return;
            mainPostListDiv.innerHTML = '';
            if (postsToRender.length === 0) {
                if(noCommunityResultsP) noCommunityResultsP.style.display = 'block';
                return;
            }
            if(noCommunityResultsP) noCommunityResultsP.style.display = 'none';

            postsToRender.forEach(post => {
                const postElement = document.createElement('div');
                postElement.classList.add('post-item-main');
                postElement.dataset.type = post.type;
                postElement.dataset.keywords = post.keywords;

                let typeTag = post.type === 'lost' ? `<span class="lost-tag">M·∫•t ƒë·ªì</span>` : `<span class="found-tag">Nh·∫∑t ƒë∆∞·ª£c</span>`;
                let rewardText = post.type === 'lost' && post.reward ? `| Treo th∆∞·ªüng: ${post.reward}` : '';

                postElement.innerHTML = `
                    <img src="${post.image}" alt="Post image">
                    <div class="post-content-main">
                        <h4>${post.title}</h4>
                        <p class="post-meta-main">Lo·∫°i: ${typeTag} | ƒêƒÉng b·ªüi: ${post.user} | ${post.time} ${rewardText} | Khu v·ª±c: ${post.location}</p>
                        <p class="post-excerpt-main">${post.description}</p>
                        <button class="app-button-outline small-btn">Li√™n H·ªá Ng∆∞·ªùi ƒêƒÉng</button>
                    </div>
                `;
                mainPostListDiv.appendChild(postElement);
            });
        }

        function filterAndSearchCommunityPosts() {
            if (!communitySearchInput || !mainPostListDiv) return; // Guard clause
            const searchTerm = communitySearchInput.value.toLowerCase().trim();
            const activeFilterBtn = document.querySelector('#view-community .filter-btn.active');
            const filterType = activeFilterBtn ? activeFilterBtn.dataset.filter : 'all';

            let filteredPosts = allCommunityPosts.filter(post => {
                const typeMatch = filterType === 'all' || post.type === filterType;
                const searchMatch = searchTerm === '' || 
                                    post.title.toLowerCase().includes(searchTerm) || 
                                    post.description.toLowerCase().includes(searchTerm) ||
                                    post.location.toLowerCase().includes(searchTerm) ||
                                    (post.keywords && post.keywords.toLowerCase().includes(searchTerm));
                return typeMatch && searchMatch;
            });
            renderCommunityPosts(filteredPosts);
        }

        if(communitySearchInput) {
            communitySearchInput.addEventListener('input', filterAndSearchCommunityPosts);
        }
        if(communityFilterBtns) {
            communityFilterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    communityFilterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterAndSearchCommunityPosts();
                });
            });
        }

        function renderMyPosts() {
            if (!accountUserPostListDiv) return;
            accountUserPostListDiv.innerHTML = '';
            if (myPosts.length === 0) {
                accountUserPostListDiv.innerHTML = '<p><em>B·∫°n ch∆∞a ƒëƒÉng tin n√†o.</em></p>';
                return;
            }
            myPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.classList.add('post-item-main');
                let typeTag = post.type === 'lost' ? `<span class="lost-tag">M·∫•t ƒë·ªì</span>` : `<span class="found-tag">Nh·∫∑t ƒë∆∞·ª£c</span>`;
                let rewardText = post.type === 'lost' && post.reward ? `| Treo th∆∞·ªüng: ${post.reward}` : '';
                postElement.innerHTML = `
                    <img src="${post.image}" alt="Post image">
                    <div class="post-content-main">
                        <h4>${post.title}</h4>
                        <p class="post-meta-main">Lo·∫°i: ${typeTag} | ${post.time} ${rewardText} | Khu v·ª±c: ${post.location}</p>
                        <p class="post-excerpt-main">${post.description}</p>
                        <button class="app-button-outline small-btn">Ch·ªânh s·ª≠a</button> <button class="app-button-outline small-btn btn-danger">X√≥a</button>
                    </div>
                `;
                accountUserPostListDiv.appendChild(postElement);
            });
        }

        function submitNewPostMain() {
            const titleInput = document.getElementById('post-title-main');
            const hiddenTypeInput = document.getElementById('post-type-hidden');
            const descriptionTextarea = document.getElementById('post-description-main');
            const locationInput = document.getElementById('post-location-main');
            const imageInput = document.getElementById('post-image-main');
            const rewardInput = document.getElementById('post-reward-main');

            const title = titleInput.value;
            const type = hiddenTypeInput.value;
            const description = descriptionTextarea.value;
            const location = locationInput.value;
            const imageFile = imageInput.files[0];
            const reward = type === 'lost' ? rewardInput.value : null;

            let imageUrl = imageFile ? `https://via.placeholder.com/80x80?text=·∫¢nh` : (type === 'lost' ? 'https://via.placeholder.com/80x80?text=‚ùì' : 'https://via.placeholder.com/80x80?text=‚úîÔ∏è');

            if (title && description && location) {
                const newPostData = {
                    id: Date.now(), 
                    title: title, type: type, reward: reward, description: description, location: location,
                    user: 'Ng∆∞·ªùi D√πng Hi·ªán T·∫°i', time: 'V·ª´a xong', image: imageUrl,
                    keywords: `${title} ${description} ${location}`.toLowerCase()
                };
                allCommunityPosts.unshift(newPostData); 
                myPosts.unshift(newPostData); 

                renderCommunityPosts(); 
                renderMyPosts(); 

                titleInput.value = ''; descriptionTextarea.value = ''; locationInput.value = '';
                imageInput.value = ''; if(rewardInput) rewardInput.value = '';
                closeModal('add-post-modal');
            } else {
                alert("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß c√°c tr∆∞·ªùng b·∫Øt bu·ªôc (Ti√™u ƒë·ªÅ, M√¥ t·∫£, Khu v·ª±c)!");
            }
        }
        
        // Hamburger Menu Logic
        const hamburgerButton = document.getElementById('hamburger-menu-button');
        const mainNav = document.getElementById('main-app-nav');

        if(hamburgerButton && mainNav) {
            hamburgerButton.addEventListener('click', () => {
                mainNav.classList.toggle('active');
                const isExpanded = mainNav.classList.contains('active');
                hamburgerButton.setAttribute('aria-expanded', isExpanded);
                if (isExpanded) {
                    hamburgerButton.innerHTML = '<i class="fas fa-times"></i>'; // Change to X icon
                } else {
                    hamburgerButton.innerHTML = '<i class="fas fa-bars"></i>'; // Change back to bars
                }
            });
        }


        document.addEventListener('DOMContentLoaded', () => {
            const initialViewLink = document.querySelector('.app-nav .nav-link[data-view="view-homepage"]');
            if (initialViewLink) {
                navigateToView('view-homepage', initialViewLink);
            }
            
            renderMyTags(); 
            renderCommunityPosts(); 
            renderMyPosts(); 

            const initialAccountSectionLink = document.querySelector('.account-sidebar a[data-account-section="account-personal-info"]');
            const initialAccountSection = document.getElementById('account-personal-info');
            if (initialAccountSectionLink && initialAccountSection) { 
                initialAccountSectionLink.classList.add('active');
                initialAccountSection.classList.add('current-account-section');
            }
        });
    </script>
</body>
</html>
